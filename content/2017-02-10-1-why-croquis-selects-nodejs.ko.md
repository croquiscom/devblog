---
title: 크로키가 Node.js를 선택한 이유
tags: ['Croquis','Nodejs']
date: 2017-02-10
author: Sangmin Yoon
original: http://sixmen.com/ko/tech/2017-02-08-1-why-croquis-selects-nodejs/
---

현재 크로키에서는 서버용 웹 프레임워크로 [Node.js](http://nodejs.org/) 위에서
[Express](http://expressjs.com/)를 사용하고 있습니다.

이번 글에서는 어떤 이유로 Node.js를 사용하게 되었는지 설명하려고 합니다.
여러분들이 웹 프레임워크를 선택하시는 데 참고가 되었으면 합니다.

---

크로크닷컴을 설립한 것은 2012년 2월입니다.
회사를 차리면서 구상했던 것은 SNS 성격을 가진 서비스로 당연히 서버가 필요했습니다.
서버 프로그래밍은 2004년 무렵 Tomcat을 잠깐 써본 것이 전부였기 때문에
어떤 언어/프레임워크를 써야 하는지부터가 고민의 시작이었습니다.

몇 가지 후보군이 있었던 것으로 기억합니다.

첫 번째는 국내 웹에서 이미 많이 사용하고 있던 PHP입니다.

두 번째는 국내에서 또 많이 사용하는 ASP입니다.

세 번째는 대형 서비스에서 많이 사용하는 스프링입니다.
지금도 이력서를 받아보면 스프링을 사용/공부했다는 사람들이 종종 보입니다.

네 번째는 [루비 온 레일즈](http://rubyonrails.org/)입니다.

마지막이 [Node.js](http://nodejs.org/)입니다.
회사 설립 당시에 버전이 0.6이었는데, 국내에 책도 나오면서
이곳저곳에서 화제가 되었기에 살펴보았습니다.

그 외에 [장고](https://www.djangoproject.com/)도 스타트업에서 많이 쓰이고
이력서에 장고를 사용했다는 사람이 심심치 않게 보이는데, 2012년 당시에
보면서도 그냥 지나쳤던 건지 널리 쓰이지 않았던 것인지 정확히 기억나지는 않지만,
후보로 고려하지 않았던 것 같습니다.

---

PHP는 언어로서 완성도가 떨어진다고 생각하고 있었기에 배제를 했습니다.
또한, 서버로는 당연히 리눅스를 생각했기에 ASP도 바로 배제되었습니다.

스프링은 조금 고민이 되었지만, Tomcat을 통한 경험이 좋지 않아서
컴파일해서 배포해야 하는 프레임워크를 후보에서 제외했습니다.
(Tomcat과 스프링이 뭐가 다른 건지 잘 모르고,
10년 동안 많이 발전했을 수도 있지만, 워낙 거부감이 컸습니다.)

레일즈에 대해서는 지인에게 회의 중에 나온 내용을
바로바로 구현해가면서 확인해봤다는 무용담(?)을 들었던 적이 있고
2007년에 관련 책도 산 적이 있기에 (잘 보지는 않았지만),
일단 후보로 두었습니다.

Node.js는 당시에 여러 곳에서 빠르다는 이유로 주목받고 있었기에
레일즈와 두개를 주요 후보로 설정했습니다.

---

정확히 비교하자만 레일즈=Express 이고, 루비=Node.js 겠죠.
레일즈는 이미 많은 기능이 있었고,
Express는 그에 비하면 단순한 기능만을 지원했습니다.
아마 저희가 웹 서비스를 만들려고 했다면 레일즈를 골랐을 수도 있습니다.
하지만 저희는 앱만 생각하고 있었기에 웹 프로토콜(HTTP) 요청만
처리할 수 있으면 됐습니다.
그리고 반대중적(?) 성격이 조금 있어서 레일즈가 제시하는 대로
프로그램을 만들어야 한다는 것이 썩 맘에 들지는 않았습니다.

그러나 무엇보다 Node.js를 선택한 결정적인 이유는 이벤트 주도 방식 때문입니다.
대학교에서 공부할 무렵부터 스레드와 락 개념을 별로 좋아하지 않았습니다.
스레드는 컨텐스트 전환에 불필요한 비용이 많이 든다고 생각했고,
데이터를 보호하기 위해서 락이 필요한데 문제 없이 작성하는 것이 어렵다고 봤습니다.
거기에 이벤트 주도 방식으로 단일 스레드에서 동작한다는 것이 제 취향에 맞았습니다.

Node.js를 선택하는데 당시 얘기가 많던 성능 문제는 크게 고려상황은 아니였습니다.
이벤트 주도 방식때문에 스레드 방식보다는 성능이 잘 나오는게 당연하다는 생각이 있었고,
다른 언어에서도 이벤트 주도 방식을 사용한다면 성능 차이는 그렇게 나지 않을 거라고 봤습니다.
(비슷하게 작성한다면 Java 같은 컴파일 언어가 당연히 성능이 좋을 것이라 생각했습니다.)
실제로 Node.js가 아니더라도 이벤트 주도 방식을 쓰는 Netty난 Twisted 같은 것도 이미 존재했습니다.
Node.js 가 뜬 이후에 나온 Vert.x 같은 것도 있고요.

---

그럼에도 불구하고 Node.js를 선택한 것은 JavaScript라는 언어때문입니다.

프로토타입을 통한 상속이라던지,
this 바인딩등 보편적인 언어들과 다른 특성들 때문에 익히기 어려웠기에
사실 그다지 JavaScript는 좋아하는 언어는 아니였습니다.

일반적인 언어라면 어떤 것을 사용해서도 모든 일을 할 수 있다고 생각하고 있지만,
언어의 표현력에 따라 난이도는 달라집니다.
그런면에서 JavaScript는 개념이 색다르거나 잘못되어서(변수 스코프같은 경우),
제대로 사용하지 못하고 실수하기 좋은 언어라는 생각이 있었습니다.

하지만 이벤트 주도 방식에 대해서는 큰 장점이 있었습니다.
태생이 JavaScript는 브라우저 언어였기에 스레드에 대한 개념이 원래 고려되어 있지 않습니다.
(요새는 웹 워커 같은 것이 추가되고 있지만)
따라서 Node.js의 API는 모두 비동기적으로 동작하게 설계가 되어 있습니다.
반면 Java나 Python등의 언어에서는 이벤트 주도 방식으로 처리를 하려면,
원래 사용하던 API를 사용하면 안 되고 Java NIO나 Python asyncio 같은 것을 사용해야 합니다.

저는 이 차이가 제일 중요하다고 판단했습니다.
이벤트 주도 방식으로 서버를 작성하려면 블로킹 I/O를 사용하면 안 되는데,
언어/플랫폼 적으로 기본이 블로킹 I/O라면 의도치 않게 사용할 확률이 높다고 봤습니다.

---

결론적으로 서버에는 이벤트 주도 방식이 가장 좋다고 생각했는데,
언어/플랫폼 태생적으로 이벤트 주도 방식인 Node.js를 사용하는 것이 맞다고 판단했습니다.

JavaScript의 단점은 CoffeeScript를 사용하는 것으로 회피했습니다.
다만 프로젝트가 커질 수록 형검사에 대한 요구가 커져서 TypeScript로
이전하는 것을 계속 고려중입니다.

콜백의 어려움은 초반에는 [async](https://github.com/caolan/async)로,
현재는 Promise를 사용해서 피하고 있습니다.
TypeScript로 이전한 후에는 async/await를 사용해볼 예정입니다.

스프링이나 레일즈, 장고등에 비해 구인에 어려움은 조금 있지만,
현재는 Node.js를 선택한 것에 만족하고 있습니다.
