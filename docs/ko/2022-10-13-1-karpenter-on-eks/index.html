<!DOCTYPE html>
<html lang='ko'>

<head>
  <meta charset='utf-8'>

  <title>EKS클러스터 Karpenter 적용기</title>
  
  <meta name='author' content='kakaostyle.com'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>

  <meta property='og:title' content='EKS클러스터 Karpenter 적용기' />
  <meta property='og:description' content='안녕하세요! 카카오스타일 SRE팀 네사입니다. 오늘은 카카오스타일 SRE팀에서 올해 EKS 클러스터 이전을 하며 새롭게 도입 했던 AWS Karpenter 에 대해 공유를 해보려 합니다.' />
  <meta property='og:type' content='article' />
  <meta property='og:url' content='https://devblog.kakaostyle.com/ko/2022-10-13-1-karpenter-on-eks/' />
  
  <meta property='og:image' content='https://devblog.kakaostyle.com/img/og-image.png' />  
  

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
    integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
  <link href='/css/style.css?body=1' rel='stylesheet' type='text/css' media='all'>
  <link href='/css/syntax.css?body=1' rel='stylesheet' type='text/css' media='all'>
</head>

<body>
<div class='hp-navbar-top'>
  <div class='container'>
    <div class='row'>
      <div class='col-12'>
        <nav class='hp-nav'>
          <span>
            <a href='/' class='logo-a-tag'>
              <img class='hp-navbar-logo' src='/img/logo-kakaostyle.png'>
              <span class='hp-navbar-logo-font'>기술 블로그</span>
            </a>
          </span>
        </nav>
        <div class='float-right hp-navbar-top-link'>
          <a class='hp-nav-item' href='https://kakaostyle.com' target='_blank'>
            <img class='icon' src='/img/kakaostyle-icon.png'>
          </a>
          <a class='hp-nav-item' href='https://github.com/croquiscom' target='_blank'>
            <img class='icon' src='/img/github-icon.svg'>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
<div class='hp-navbar'>
  <div class='hp-navbar-bgcolor'>
    <div class='container'>
      <div class='text-center'>
        <div class='hp-navbar-title'>EKS클러스터 Karpenter 적용기</div>
      </div>
    </div>
  </div>
</div>


<div class='container'>

  <div class='row'>
    <div class='col-12'>
      <div class='post-header'>
        <div class='post-tags'>
          

<ul class='tag_box inline'>
  <li><i class='fas fa-tags'></i></li>
  
  <li>
    <a href='/ko/tags/aws'>
      AWS
      <span>7</span>
    </a>
  </li>
  
  <li>
    <a href='/ko/tags/kubernetes'>
      Kubernetes
      <span>3</span>
    </a>
  </li>
  
</ul>

        </div>
        <div class='float-right'>
          
          <div class='post-author'>
            <i class='fas fa-pencil-alt'></i>
            <span>Nessa(조이정)</span>
          </div>
          
          <div class='post-date'>
            <i class='fas fa-calendar-alt'></i>
            <span>13 October 2022</span>
          </div>
        </div>
      </div>
    </div>

    <div class='col-12 col-lg-9'>
      <p>안녕하세요! 카카오스타일 SRE팀 네사입니다. 오늘은 카카오스타일 SRE팀에서 올해 EKS 클러스터 이전을 하며 새롭게 도입 했던 <strong>AWS Karpenter</strong> 에 대해 공유를 해보려 합니다.</p>
<h2 id="카카오스타일의-고민">카카오스타일의 고민</h2>
<p>EKS 클러스터를 운영하는 엔지니어라면 누구나 확장성에 대한 고민을 한 번쯤 하게 됩니다. agility 가 생명인 마이크로 서비스 환경에서 Pod 나 Node 의 확장이 빠르게 되지 않는다면 서비스 속도뿐만 아니라 비용이나 관리 효율에도 영향을 미치게 됩니다. 확장성에 관한 우리의 요구사항은 늘 간단명료합니다. 빠르게 확장하고, 편하게 관리하며, 거기에 유연성까지 갖췄다면 금상첨화겠죠!</p>
<p>카카오스타일 역시 대부분의 주요 마이크로서비스가 EKS 상에서 운영되고 있고, 유저들이 많이 사용하는 시간대 패턴이 있다 보니 하루에도 몇 번씩 Node 가 늘어났다 줄어드는 경험을 하게 됩니다. 카카오스타일도 처음에는 Kubernetes 의 기본 <strong>Cluster Autoscaler(CA)</strong> 를 사용했습니다. <strong>Cloud Service Provider(CSP)</strong> 에 따라 다르겠지만 AWS 의 경우는 <strong>AutoScaling Group(ASG)</strong> 을 통해 <strong>CA</strong> 기능을 구현하기 때문에 클러스터의 확장 시나리오는 다음과 같아집니다.</p>
<p>&lt;Cluster Autoscaler 동작 원리&gt;</p>
<p><img src="/img/content/2022-10-13-1/cluster_autoscaler.png" alt="cluster_autoscaler"></p>
<ol>
<li><strong>Horizontal Pod AutoScaler(HPA)</strong> 에 의한 pod의 수평적 확장이 한계에 다다르면, pod는 적절한 Node 를 배정받지 못하고 pending 상태에 빠집니다.</li>
<li>이때 <strong>CA</strong> 는 Pod 의 상태를 관찰하다가 지속해서 할당에 실패하면 <strong>Node Group</strong> 의 <strong>ASG</strong> Desired Capacity 값을 수정하여 Worker Node 개수를 증가하도록 설정합니다.</li>
<li>이를 인지한 <strong>ASG</strong> 가 새로운 Node를 추가합니다.</li>
<li>여유 공간이 생기면 <strong>kube-scheduler</strong> 가 Pod를 새 Node에 할당합니다.</li>
</ol>
<p>하지만 <strong>CA</strong> 방식은 AWS 리소스인 <strong>ASG</strong> 에 의존도가 높기 때문에 Node 추가에 생각보다 오랜 시간이 걸립니다. 카카오스타일에서도 기존 Node 의 EBS 타입을 gp2 에서 gp3 로 업데이트 하기 위해 약 10여 대의 Node 를 재배포한 적이 있는데, 한 대씩 rolling 이 되는 데다 엔지니어가 작업에 개입하기 어려워 약 1시간 정도 지켜만 볼 수밖에 없었던 경험이 있습니다. 여기에 만약 Node 에 custom userdata 를 추가해야 한다면 <strong>Launch template</strong> 을 따로 관리해야하고, 워크로드별 인스턴스 요구사항이 달라 여러 <strong>관리형 Node Group</strong> 을 도입해야 한다면 여러 벌의 <strong>ASG</strong> 을 운영해야 하는 등 운영 부담이 늘어납니다.</p>
<p>별다른 대안이 없어 아쉬운 대로 운영해야만 했는데, 마침 2021년 11월 <a href="https://aws.amazon.com/ko/blogs/aws/introducing-karpenter-an-open-source-high-performance-kubernetes-cluster-autoscaler/">AWS 새소식 블로그</a>에 올라온 글을 보고 <strong>AWS Karpenter</strong> 의 존재를 알게 되었습니다.</p>
<h2 id="karpenter카펜터-란">Karpenter(카펜터) 란?</h2>
<p><img src="/img/content/2022-10-13-1/karpenter_logo.png" alt="karpenter_logo"></p>
<p><strong><a href="https://karpenter.sh/">Karpenter</a></strong> 는 AWS 가 개발한 Kubernetes 의 Worker Node 자동 확장 기능을 수행하는 오픈소스 프로젝트입니다. 앞서 말한 <strong>Cluster Autoscaler (CA)</strong> 와 비슷한 역할을 수행하지만, AWS 리소스에 의존성이 없어 <strong>JIT(Just In-Time)</strong> 배포가 가능하다는 점에서 다른 확장 시나리오를 가지고 있습니다.</p>
<p>&lt;Karpenter 동작 원리&gt;</p>
<p><img src="/img/content/2022-10-13-1/karpenter_logic.png" alt="karpenter_logic"></p>
<ol>
<li><strong>Horizontal Pod AutoScaler(HPA)</strong> 에 의한 Pod의 수평적 확장이 한계에 다다르면, Pod 는 적절한 Node 를 배정받지 못하고 pending 상태에 빠집니다.</li>
<li>이때 <strong>Karpenter</strong> 는 지속해서 unscheduled Pod 를 관찰하고 있다가, 새로운 Node 추가를 결정하고 직접 배포합니다.</li>
<li>추가된 Node가 Ready 상태가 되면 <strong>Karpenter</strong> 는 <strong>kube-scheduler</strong> 를 대신하여 pod 의 <strong>Node binding</strong> 요청도 수행합니다.</li>
</ol>
<p>위와 같이 <strong>Karpenter</strong> 는 기존 <strong>CA</strong> 에 비해 훨씬 단순한 구조를 가지고 있으며 클러스터 확장 시 일어나는 많은 부분을 <strong>Karpenter</strong> 에서 직접 처리해서 빠르게 확장을 처리할 수 있도록 설계되었습니다. 모든 Worker Node 는 <strong>Karpenter</strong> 에 의해 lifecycle 이 결정됩니다.</p>
<p>이에 따라 카카오스타일에서 <strong>Karpenter</strong> 를 도입했을 때 얻을 수 있는 장점을 정리해보면 다음과 같았습니다.</p>
<h2 id="karpenter-의-장점">Karpenter 의 장점</h2>
<p><strong>1) 운영 부담 절감</strong></p>
<p><strong>CA</strong> 를 사용하면 Node 의 운영 요구사항을 반영하기 위해 <strong>ASG</strong> 나 <strong>Launch Template</strong> 와 같은 AWS 자원들을 추가로 관리해야 했습니다. 반면에 <strong>Karpenter</strong> 는 설치 후 <strong>Provisioner</strong> 라는 CRD 만 구성해주면, <strong>ASG</strong> 나 <strong>Launch Template</strong> 을 관리할 필요 없이 인스턴스 타입이나 스토리지 크기, IAM 역할 등을 정의하여 사용할 수 있습니다. 또한 <strong>Provisioner</strong> 를 용도별로 구성하면 별도로 관리형 <strong>Node Group</strong> 을 생성하고 운영할 필요가 없어 Node 운영 부담이 절감됩니다. <strong>Provisioner</strong> 에 대해서는 아래에서 조금 더 자세히 설명하겠습니다.</p>
<p><strong>2) 신속한 Node 추가와 제거</strong></p>
<p><strong>Karpenter</strong> 를 사용하면 위에 설명한 설계 구조에 따라 Node 의 추가 속도가 빨라집니다. Pod 를 할당할 수 있는 용량이 모자라면 즉시 추가가 되기 때문에 기존 CA 방식에 비해 훨씬 빠른 속도(약 ~1.5분)를 체감할 수 있습니다. 또 반대로 불필요한 Empty Node 가 있는 경우 정리되는 속도도 빠른데, Node 제거에 대해서는 <strong>Provisioner</strong> 에 정의할 수 있는 <code>ttlSecondsAfterEmpty</code> 파라미터값을 정의하여 사용자 정의할 수도 있습니다. (카카오스타일은 30초로 설정하여 쓰고 있습니다.)</p>
<p><strong>3) 자동 Node 롤링</strong></p>
<p>EKS 클러스터 운영을 하다 보면 특정 Node 사용이 장기화되어 보안 패치등에 대한 우려가 생길 수 있습니다. 이때  <strong>Karpenter Provisioner</strong> 에 <code>ttlSecondsUntilExpired</code> 파라미터를 정의하여 Node 를 주기적으로 rolling update 할 수 있는데요, Node 가 수명이 다하면 Node drain 과 delete 를 차례대로 수행하여 최신 버전의 <code>amazon-eks-node</code> 이미지로 신규 Node 를 띄우게 됩니다. 카카오스타일의 경우 Node 베이스 이미지의 보안 패치가 상당히 잦다는 사실을 고려하여 이 값을 <code>1209600</code>로 정의하고 14일마다 롤링이 되도록 하고 있습니다. 한꺼번에 생성되었던 Node가 아니라면 ttl 에 맞춰 개별적으로 롤링이 되기 때문에 HA 가 구현된 클러스터 환경에서는 서비스에 영향을 끼치지 않습니다.</p>
<p><strong>4) 다양한 인스턴스 타입을 쉽게 적용</strong></p>
<p>앞서 <strong>Karpenter</strong> 를 사용하면 이전에 관리형 <strong>Node Group</strong> 이나 <strong>Launch Template</strong> 으로 정의해야 했던 인스턴스 타입을 <strong>Provisioner</strong> 로 관리하게 된다고 언급했습니다. <strong>Launch template</strong> 에서는 하나의 인스턴스 타입만 선정할 수 있고, <strong>Node Group</strong> 에서 정의하게 되면 다음과 같은 안내가 뜹니다.</p>
<p><img src="/img/content/2022-10-13-1/instance_types.png" alt="instance_types"></p>
<p>하지만 <strong>Provisioner</strong> 에서는 다음과 같이 다양한 인스턴스 타입을 정의할 수 있습니다. 이렇게 되면 사용 리전 내 인스턴스 가용성을 걱정해야 할 일도 줄어들고, 신규 Node 추가 시 <strong>Karpenter</strong> 가 요청 Pod 에 가장 적절한 인스턴스 타입을 골라 기동하므로 Kubernetes 클러스터 운영 효율을 논할 때 늘 나오는 <a href="https://kubernetes.io/ko/docs/concepts/scheduling-eviction/resource-bin-packing/">bin packing</a> 문제도 개선할 수 있습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">  </span><span class="nt">requirements</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;node.kubernetes.io/instance-type&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l">In</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;m6i.2xlarge&#34;</span><span class="p">,</span><span class="s2">&#34;m6i.4xlarge&#34;</span><span class="p">,</span><span class="s2">&#34;m6i.8xlarge&#34;</span><span class="p">,</span><span class="s2">&#34;c6i.2xlarge&#34;</span><span class="p">,</span><span class="s2">&#34;c6i.4xlarge&#34;</span><span class="p">,</span><span class="s2">&#34;c6i.8xlarge&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;topology.kubernetes.io/zone&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l">In</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&#34;ap-northeast-2a&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;ap-northeast-2c&#34;</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;karpenter.sh/capacity-type&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l">In</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;on-demand&#34;</span><span class="p">]</span><span class="w">
</span></span></span></code></pre></div><p><strong>5) 빠른 버전 업그레이드에 따른 기대</strong></p>
<p><strong>Karpenter</strong> 는 2021년 11월 처음 GA되어 2022년 09월까지 60여 번의 버전 릴리즈가 있었을 만큼 빠르게 업데이트되고 있습니다. 그사이 <strong>podAffinity</strong> 나 userdata 를 지원하는 등 다양한 필요 기능들이 추가되어 왔는데요. 예를 들어 카카오스타일에서도 Node에 추가 모듈을 설치하기 위해 처음에는 <strong>Launch Template</strong> 을 따로 정의하여 사용했지만, 얼마 안 가 userdata 를 정의할 수 있도록 <strong>AWSNodeTemplate</strong> CRD 가 나와 최신 AMI 를 유지하면서도 userdata 를 정의할 수 있게 되었습니다.</p>
<p>처음 <strong>Karpenter</strong> 가 나왔을 때, 운영 환경에 적용이 가능한 서비스라고 소개가 되었지만 아직 <code>v0.x</code> 으로 베타 버전에 가깝다는 점, 그리고 아직 국내 레퍼런스가 없다는 점 등에 대한 우려가 있었지만 이러한 <strong>Karpenter</strong> 의 특징이 카카오스타일의 클러스터 확장 요구사항에 잘 맞는다는 사실에 착안하여 신중한 PoC 를 거쳐 최종적으로 2022년 운영 환경에 까지 적용을 하게 되었습니다.</p>
<h2 id="karpenter-적용-과정">Karpenter 적용 과정</h2>
<p><strong>Karpenter</strong> 는 helm chart 를 통해 설치할 수 있습니다. 카카오스타일은 <strong>Terraform</strong> 을 이용해 인프라를 관리하므로 EKS 클러스터를 생성할 때 <strong>Karpenter</strong> 도 <strong>Terraform</strong> 코드로 정의하여 함께 생성했습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-terraform" data-lang="terraform"><span class="line"><span class="cl"><span class="kr">resource</span> <span class="s2">&#34;helm_release&#34;</span> <span class="s2">&#34;karpenter&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="na">depends_on</span>       = <span class="p">[</span><span class="nb">module</span><span class="p">.</span><span class="nx">eks</span><span class="p">.</span><span class="nx">kubeconfig</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="na">namespace</span>        = <span class="s2">&#34;karpenter&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">create_namespace</span> = <span class="kc">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="na">name</span>       = <span class="s2">&#34;karpenter&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">repository</span> = <span class="s2">&#34;https://charts.karpenter.sh&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">chart</span>      = <span class="s2">&#34;karpenter&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">version</span>    = <span class="s2">&#34;v0.16.0&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">set</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="na">name</span>  = <span class="s2">&#34;replicas&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">value</span> = <span class="m">2</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">set</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="na">name</span>  = <span class="s2">&#34;serviceAccount.annotations.eks\\.amazonaws\\.com/role-arn&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">value</span> = <span class="nb">module</span><span class="p">.</span><span class="nx">iam_assumable_role_karpenter</span><span class="p">.</span><span class="nx">iam_role_arn</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">set</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="na">name</span>  = <span class="s2">&#34;clusterName&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">value</span> = <span class="nx">local</span><span class="p">.</span><span class="nx">cluster_name</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">set</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="na">name</span>  = <span class="s2">&#34;clusterEndpoint&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">value</span> = <span class="nb">module</span><span class="p">.</span><span class="nx">eks</span><span class="p">.</span><span class="nx">cluster_endpoint</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">set</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="na">name</span>  = <span class="s2">&#34;aws.defaultInstanceProfile&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">value</span> = <span class="nx">aws_iam_instance_profile</span><span class="p">.</span><span class="nx">karpenter</span><span class="p">.</span><span class="nx">name</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><strong>Karpenter</strong> 를 설치하면 Kubernetes 클러스터에서는 다음과 같은 Pod 설정을 확인할 수 있습니다.</p>
<p><img src="/img/content/2022-10-13-1/karpenter_pods.png" alt="karpenter_pods"></p>
<p><img src="/img/content/2022-10-13-1/karpenter_pod_detail.png" alt="karpenter_pod_detail"></p>
<p><strong>Karpenter</strong> Pod 는 <strong>Controller</strong> 와 <strong>Webhook</strong> 컨테이너로 이루어져 있습니다. <strong>Controller</strong> 는 Kubernetes Controller 의 일종으로 pod 상태를 감시하고 Node 를 확장 및 축소하는 주요 역할을 하는데, <strong>Node selector</strong>등이 일치하지 않아 할당할 수 있는 Node 가 없는 경우, 여기에서 에러로그를 확인할 수 있습니다. <strong>Webhook</strong> 은 <strong>Provisioner</strong> CRD 에 대한 유효성 검사 및 기본값을 지정하는 역할을 합니다.</p>
<p>그 다음엔 여러 번 언급했던 <strong>Provisioner</strong> CRD 을 생성합니다. <strong>Provisioner</strong> 는 <strong>Karpenter</strong> 에 의해 생성되는 Node 와 Pod 에 대한 제약조건을 지정하기 위해 <strong>Karpenter</strong> 에서 제공되는 Custom Resource 입니다. 카카오스타일에서는 용도에 따라 여러 <strong>Provisioner</strong> 를 운영하는데, 그중 높은 네트워크 요구사항을 가진 Pod 를 할당하기 위한 <code>test-network</code> <strong>Provisioner</strong> 를 예시로 들어보겠습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">karpenter.sh/v1alpha5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Provisioner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">test-network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">taints</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">networkNode</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="l">NoSchedule</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">phase</span><span class="p">:</span><span class="w"> </span><span class="l">test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nodeType</span><span class="p">:</span><span class="w"> </span><span class="l">network-node</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">requirements</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;node.kubernetes.io/instance-type&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l">In</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;c5n.4xlarge&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;topology.kubernetes.io/zone&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l">In</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&#34;ap-northeast-2a&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;ap-northeast-2c&#34;</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;karpenter.sh/capacity-type&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l">In</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;on-demand&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">providerRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">enable-ipvs-test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ttlSecondsAfterEmpty</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span></span></span></code></pre></div><p>그리고 해당 Node의 경우 <strong>kubeproxy</strong> 의 <code>ipvs</code> 모드를 테스트 하기 위해 userdata 정의가 필요했으므로 <strong>AWSNodeTemplate</strong> 도 정의했습니다. <strong>Provisioner</strong> 와 <strong>AWSNodeTemplate</strong> 는 <code>providerRef</code> 파라미터에 의해 상호 연결됩니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">karpenter.k8s.aws/v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">AWSNodeTemplate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">enable-ipvs-test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">subnetSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">karpenter.sh/discovery/test-cluster</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;*&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">securityGroupSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">aws:eks:cluster-name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;test-cluster&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">instanceProfile</span><span class="p">:</span><span class="w"> </span><span class="l">KarpenterNodeInstanceProfile-test-cluster</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">blockDeviceMappings</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">deviceName</span><span class="p">:</span><span class="w"> </span><span class="l">/dev/xvda</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ebs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">volumeSize</span><span class="p">:</span><span class="w"> </span><span class="l">20Gi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">volumeType</span><span class="p">:</span><span class="w"> </span><span class="l">gp3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">iops</span><span class="p">:</span><span class="w"> </span><span class="m">3000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">deleteOnTermination</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">throughput</span><span class="p">:</span><span class="w"> </span><span class="m">125</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">userData</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    MIME-Version: 1.0
</span></span></span><span class="line"><span class="cl"><span class="sd">    Content-Type: multipart/mixed; boundary=&#34;BOUNDARY&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    --BOUNDARY
</span></span></span><span class="line"><span class="cl"><span class="sd">    Content-Type: text/x-shellscript; charset=&#34;us-ascii&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    #!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="sd">    sudo yum install -y ipvsadm
</span></span></span><span class="line"><span class="cl"><span class="sd">    sudo ipvsadm -l
</span></span></span><span class="line"><span class="cl"><span class="sd">    sudo modprobe ip_vs
</span></span></span><span class="line"><span class="cl"><span class="sd">    sudo modprobe ip_vs_rr
</span></span></span><span class="line"><span class="cl"><span class="sd">    sudo modprobe ip_vs_wrr
</span></span></span><span class="line"><span class="cl"><span class="sd">    sudo modprobe ip_vs_sh
</span></span></span><span class="line"><span class="cl"><span class="sd">    sudo modprobe nf_conntrack_ipv4
</span></span></span><span class="line"><span class="cl"><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    --BOUNDARY--</span><span class="w">    
</span></span></span></code></pre></div><p><strong>Provisioner</strong> 와 <strong>AWSNodeTemplate</strong> 을 적용하고 나면 다음과 같이 확인할 수 있습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get provisioner
</span></span><span class="line"><span class="cl">NAME                          AGE
</span></span><span class="line"><span class="cl">test-network                  10s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ kubectl get awsnodetemplate
</span></span><span class="line"><span class="cl">NAME                     AGE
</span></span><span class="line"><span class="cl">enable-ipvs-test              15s
</span></span></code></pre></div><p>자, 이제 간단하게 <strong>Karpenter</strong> 구성이 끝났으니 확인만 하면 됩니다. 주의할 점은 <strong>deployment</strong> 를 정의할 때 적절한 <code>tolerations</code>와 <code>nodeSelector</code>(혹은 <code>nodeAffinity</code> )를 가지고 있는지만 확인하면 됩니다. 테스트로 nginx 를 띄워보았습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">...(생략)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">nodeType</span><span class="p">:</span><span class="w"> </span><span class="l">network-node</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">tolerations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="l">NoSchedule</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">node-role.kubernetes.io/master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">CriticalAddonsOnly</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l">Exists</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;NoSchedule&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;networkNode&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Equal&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span></code></pre></div><p>이제 Pod 를 기동하면 빠르게 원하는 <strong>Provisioner</strong> 가 추가한 Node 에 할당되는 것을 확인할 수 있습니다! 제가 애용하는 <a href="https://k9scli.io/">k9s</a> 도구를 통해 살펴보겠습니다.</p>
<p>제일 처음, Pod 는 Node 정보가 n/a 로 뜨면서 <code>pending</code> 상태가 되었습니다.</p>
<p><img src="/img/content/2022-10-13-1/progress1.png" alt="progress1"></p>
<p>그리고 이와 거의 동시에 Node 추가가 시작되었습니다.</p>
<p><img src="/img/content/2022-10-13-1/progress2.png" alt="progress2"></p>
<p>불과 <strong>55초</strong>만에 <code>NodeReady</code> 상태가 되었습니다.</p>
<p><img src="/img/content/2022-10-13-1/progress3.png" alt="progress3"></p>
<p>이후 Pod 는 바로 Node 에 binding 되어 약 <strong>78초 내</strong>에 정상 구동을 시작했습니다.</p>
<p><img src="/img/content/2022-10-13-1/progress4.png" alt="progress4"></p>
<p>이때, Karpenter controller pod 의 로그에서는 다음과 같은 로그가 생성되었습니다.</p>
<pre tabindex="0"><code>INFO    controller.provisioning    Found 1 provisionable pod(s)    {&#34;commit&#34;: &#34;639756a&#34;}
INFO    controller.provisioning    Computed 1 new node(s) will fit 1 pod(s)    {&#34;commit&#34;: &#34;639756a&#34;}
INFO    controller.provisioning    Launching node with 1 pods requesting {&#34;cpu&#34;:&#34;125m&#34;,&#34;pods&#34;:&#34;3&#34;} from types c5n.2xlarge    {&#34;commit&#34;: &#34;639756a&#34;, &#34;provisioner&#34;: &#34;test-network&#34;}
</code></pre><p>또, 만약 해당 deployment 를 삭제하여 Node 가 비면, 다음과 같은 로그가 찍힙니다.</p>
<pre tabindex="0"><code>INFO controller.node Added TTL to empty node {&#34;commit&#34;: &#34;639756a&#34;, &#34;node&#34;: &#34;ip-xx-x-xxx-xxx.ap-northeast-2.compute.internal&#34;}
</code></pre><p><strong>Provisioner</strong> 의 <code>ttlSecondsAfterEmpty</code>에서 지정한 TTL이 지나면 Node 는 삭제가 됩니다.</p>
<h2 id="잠깐-이건-주의합시다">‼️ 잠깐, 이건 주의합시다</h2>
<p><strong>Karpenter</strong> 를 사용하면 대부분의 주요 서비스들이 사용하는 Node 를  <strong>Provisioner</strong> 로 관리하게 되기 때문에 처음  EKS 클러스터를 생성할 때 기본적으로 생성되는 default Node 에 대해 간과하기가 쉽습니다. 하지만 이 Node 들에는 모든 DNS 요청을 처리하는 <strong>CoreDNS</strong> Pod 가 있으므로 너무 작은 인스턴스 타입을 설정하는 경우 클러스터 동작에 문제가 될 수 있습니다. (이걸 왜 알고 있냐하면 저희도 알고 싶지 않았습니다 ..^^)</p>
<p>그리고 <strong>Provisioner</strong> 설정 시 Security Group 지정에 주의해야합니다. <strong>Provisioner</strong> 에서는 <code>securityGroupSelector</code> 파라미터를 이용해 Security Group 을 지정할 수 있고, <strong>Karpenter</strong> 는 이 selector 와 일치하는 Tag 를 가진 모든 Security Group 을 가져와 Node 에 할당합니다. 이 때 동일한 태그를 가진 Security Group(예 : <code>kubernetes.io/cluster/MyClusterName: owned</code> )이 2개 이상 있는 경우, <strong>AWS Load Balancer controller</strong> 동작에 문제가 생겨 <strong>Ingress</strong> 가 정상적으로 생성이 되지 않을 수 있습니다. 그 이유는 <strong>AWS Load Balancer controller</strong> 가 해당 Tag 를 가진 Security Group 을 하나만 지원하기 때문인데, 자세한 내용은 <a href="https://github.com/kubernetes-sigs/aws-load-balancer-controller/issues/2367">여기</a>에서 확인할 수 있습니다. 카카오스타일은 <code>aws:eks:cluster-name</code> 태그로 지정하여 이슈를 피했습니다. 만약 이 이슈 때문에 AWS ELB <strong>ingress</strong> 가 생성되지 않는다면 연관성 찾기가 만만치 않습니다…^^ 동일 태그를 지닌 Security Group 이 있는지 확인하기 위해서는 다음과 같은 AWS cli 를 사용할 수 있습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nv">CLUSTER_VPC_ID</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>aws eks describe-cluster --name <span class="nv">$CLUSTER_NAME</span> --query cluster.resourcesVpcConfig.vpcId --output text<span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ aws ec2 describe-security-groups --filters <span class="nv">Name</span><span class="o">=</span>vpc-id,Values<span class="o">=</span><span class="nv">$CLUSTER_VPC_ID</span> <span class="nv">Name</span><span class="o">=</span>tag-key,Values<span class="o">=</span>kubernetes.io/cluster/<span class="nv">$CLUSTER_NAME</span> --query SecurityGroups<span class="o">[]</span>.<span class="o">[</span>GroupName<span class="o">]</span> --output text
</span></span></code></pre></div><p>참고로 <strong>Karpenter</strong> <strong>Provisioner</strong> yaml 수정 후 다시 apply 했을 때, 이전 <strong>Provisioner</strong> 설정에 의해 생성된 Node 가 자동으로 교체되지 않기 때문에 바로 반영이 필요하다면 별도로 롤링 업데이트를 해주어야합니다.</p>
<p>마지막으로, <strong>Karpenter</strong> 는 비교적 신규 서비스인만큼 초기 버전에서는 잘 동작하지 않는 기능이 많습니다. 예를 들어, 카카오스타일에서는 Node 에 특정 Pod 를 격리하기 위해 <code>podAffinity</code> 와 <code>podAntiAffinity</code> 를 지정하려고 했는데, 의도한 대로 동작하지 않아 헤매다가 <code>v0.9.0</code>에서 새롭게 추가된 기능인 것을 확인하고 버전을 업데이트 했던 경험이 있습니다. 따라서 <strong>Karpenter</strong> 를 사용할 땐 가능한 최신 버전을 사용하는 것을 추천합니다.</p>
<h2 id="끝으로">끝으로,</h2>
<p>얼마 전 AWS에서 Enterprise Support 고객들을 상대로 진행했던 HighLander 행사에서 다들 아직 <strong>Karpenter</strong> 에 대한 신뢰가 부족하다는 인상을 받았는데요, 도입을 고민하시는 분들께 이 글이 도움이 되었으면 합니다. 감사합니다!</p>
      
    </div>

    <div class='col-lg-3 sidemenu'>
  <h4>Recent Posts</h4>
  <ul class="sidemenu-recent-list">
    
    <a href='/ko/2022-11-15-3-understanding-graphql-4-resolver-arguments-4-info/'>
      <li class="sidemenu-recent-item">GraphQL 이해하기: (4) 리졸버 인자 - 4. info</li>
    </a>
    
    <a href='/ko/2022-11-15-2-understanding-graphql-4-resolver-arguments-3-context/'>
      <li class="sidemenu-recent-item">GraphQL 이해하기: (4) 리졸버 인자 - 3. context</li>
    </a>
    
    <a href='/ko/2022-11-15-1-understanding-graphql-4-resolver-arguments-2-args/'>
      <li class="sidemenu-recent-item">GraphQL 이해하기: (4) 리졸버 인자 - 2. args</li>
    </a>
    
    <a href='/ko/2022-11-12-1-understanding-graphql-4-resolver-arguments-1-source/'>
      <li class="sidemenu-recent-item">GraphQL 이해하기: (4) 리졸버 인자 - 1. source</li>
    </a>
    
  </ul>
  <hr>
  <h4>Tags</h4>
  <ul class="sidemenu-recent-list">
    
    <a href="/ko/tags/amazon-sqs/">
      <li class="sidemenu-recent-tags">amazon-sqs</li>
    </a>
    
    <a href="/ko/tags/analytics/">
      <li class="sidemenu-recent-tags">analytics</li>
    </a>
    
    <a href="/ko/tags/android/">
      <li class="sidemenu-recent-tags">android</li>
    </a>
    
    <a href="/ko/tags/aws/">
      <li class="sidemenu-recent-tags">aws</li>
    </a>
    
    <a href="/ko/tags/aws-batch/">
      <li class="sidemenu-recent-tags">aws-batch</li>
    </a>
    
    <a href="/ko/tags/aws-lambda/">
      <li class="sidemenu-recent-tags">aws-lambda</li>
    </a>
    
    <a href="/ko/tags/botkit/">
      <li class="sidemenu-recent-tags">botkit</li>
    </a>
    
    <a href="/ko/tags/croquis/">
      <li class="sidemenu-recent-tags">croquis</li>
    </a>
    
    <a href="/ko/tags/css/">
      <li class="sidemenu-recent-tags">css</li>
    </a>
    
    <a href="/ko/tags/data/">
      <li class="sidemenu-recent-tags">data</li>
    </a>
    
    <a href="/ko/tags/event/">
      <li class="sidemenu-recent-tags">event</li>
    </a>
    
    <a href="/ko/tags/front-end/">
      <li class="sidemenu-recent-tags">front-end</li>
    </a>
    
    <a href="/ko/tags/frontend/">
      <li class="sidemenu-recent-tags">frontend</li>
    </a>
    
    <a href="/ko/tags/git/">
      <li class="sidemenu-recent-tags">git</li>
    </a>
    
    <a href="/ko/tags/github/">
      <li class="sidemenu-recent-tags">github</li>
    </a>
    
    <a href="/ko/tags/graphql/">
      <li class="sidemenu-recent-tags">graphql</li>
    </a>
    
    <a href="/ko/tags/ios/">
      <li class="sidemenu-recent-tags">ios</li>
    </a>
    
    <a href="/ko/tags/jenkins/">
      <li class="sidemenu-recent-tags">jenkins</li>
    </a>
    
    <a href="/ko/tags/jotai/">
      <li class="sidemenu-recent-tags">jotai</li>
    </a>
    
    <a href="/ko/tags/kubernetes/">
      <li class="sidemenu-recent-tags">kubernetes</li>
    </a>
    
    <a href="/ko/tags/log/">
      <li class="sidemenu-recent-tags">log</li>
    </a>
    
    <a href="/ko/tags/microservice/">
      <li class="sidemenu-recent-tags">microservice</li>
    </a>
    
    <a href="/ko/tags/mithril/">
      <li class="sidemenu-recent-tags">mithril</li>
    </a>
    
    <a href="/ko/tags/node.js/">
      <li class="sidemenu-recent-tags">node.js</li>
    </a>
    
    <a href="/ko/tags/nodejs/">
      <li class="sidemenu-recent-tags">nodejs</li>
    </a>
    
    <a href="/ko/tags/npm/">
      <li class="sidemenu-recent-tags">npm</li>
    </a>
    
    <a href="/ko/tags/react/">
      <li class="sidemenu-recent-tags">react</li>
    </a>
    
    <a href="/ko/tags/rest-api/">
      <li class="sidemenu-recent-tags">rest-api</li>
    </a>
    
    <a href="/ko/tags/serverless-architecture/">
      <li class="sidemenu-recent-tags">serverless-architecture</li>
    </a>
    
    <a href="/ko/tags/slack/">
      <li class="sidemenu-recent-tags">slack</li>
    </a>
    
    <a href="/ko/tags/stack/">
      <li class="sidemenu-recent-tags">stack</li>
    </a>
    
    <a href="/ko/tags/task-queue/">
      <li class="sidemenu-recent-tags">task-queue</li>
    </a>
    
    <a href="/ko/tags/thrift/">
      <li class="sidemenu-recent-tags">thrift</li>
    </a>
    
    <a href="/ko/tags/tutorial/">
      <li class="sidemenu-recent-tags">tutorial</li>
    </a>
    
    <a href="/ko/tags/typescript/">
      <li class="sidemenu-recent-tags">typescript</li>
    </a>
    
    <a href="/ko/tags/ui/">
      <li class="sidemenu-recent-tags">ui</li>
    </a>
    
    <a href="/ko/tags/vertical-align/">
      <li class="sidemenu-recent-tags">vertical-align</li>
    </a>
    
    <a href="/ko/tags/webpack/">
      <li class="sidemenu-recent-tags">webpack</li>
    </a>
    
    <a href="/ko/tags/%EB%A1%9C%EA%B7%B8/">
      <li class="sidemenu-recent-tags">로그</li>
    </a>
    
    <a href="/ko/tags/%EB%A7%88%EC%9D%B4%ED%81%AC%EB%A1%9C%EC%84%9C%EB%B9%84%EC%8A%A4/">
      <li class="sidemenu-recent-tags">마이크로서비스</li>
    </a>
    
    <a href="/ko/tags/%ED%8A%9C%ED%86%A0%EB%A6%AC%EC%96%BC/">
      <li class="sidemenu-recent-tags">튜토리얼</li>
    </a>
    
  </ul>
</div>

    <div class='col-12'>
      <hr>

      <div class='float-left'>
        
        <a class='btn btn-outline-primary' href='/ko/2022-10-12-1-sync-data-between-activities/' title='웹뷰 액티비티간 데이터 동기화하기'>&larr; 이전 글</a>
        
      </div>
      <div class='float-right'>
        
        <a class='btn btn-outline-primary' href='/ko/2022-11-07-1-understanding-graphql-2-execution/' title='GraphQL 이해하기: (2) 실행 및 전송'>다음 글 &rarr;</a>
        
      </div>
      <div class='clearfix'></div>
      <hr>
      <div class='text-center'>
        <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "croquiscom-devblog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </div>
  </div>

</div>

<div class='container'>
  <hr>
  <footer>
    <p>
      &copy; 2012-2021 kakaostyle.com
      <span class='float-right text-muted'>
        powered by
        <a href='https://gohugo.io/' target='_blank'>Hugo</a>
        and
        <a href='https://getbootstrap.com/' target='_blank'>Bootstrap</a>
      </span>
    </p>
  </footer>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-48716672-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
  integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
  integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"
  integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
<script src="https://use.fontawesome.com/releases/v5.0.13/js/all.js"
  integrity="sha384-xymdQtn1n3lH2wcu0qhcdaOpQwyoarkgLVxC/wZ5q7h9gHtxICrpcaSUfygqZGOe" crossorigin="anonymous"></script>

</body>

</html>
