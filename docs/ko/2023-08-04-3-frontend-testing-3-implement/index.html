<!DOCTYPE html>
<html lang='ko'>

<head>
  <meta charset='utf-8'>

  <title>프론트엔드 테스트 자동화 전략 - 3. 구현하기</title>
  
  <meta name='author' content='kakaostyle.com'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>

  <meta property='og:title' content='프론트엔드 테스트 자동화 전략 - 3. 구현하기' />
  <meta property='og:description' content='이전 글에서는 제품의 요구사항을 분석하며, 테스트 케이스를 산출하는 방법에 대해 알아봤습니다. 이 글에서는 구체적으로 어떻게 테스트 코드를 작성할 수 있는지에 대해 알아봅니다.' />
  <meta property='og:type' content='article' />
  <meta property='og:url' content='https://devblog.kakaostyle.com/ko/2023-08-04-3-frontend-testing-3-implement/' />
  
  <meta property='og:image' content='https://devblog.kakaostyle.com/img/og-image.png' />  
  

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
    integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
  <link href='/css/style.css?body=1' rel='stylesheet' type='text/css' media='all'>
  <link href='/css/syntax.css?body=1' rel='stylesheet' type='text/css' media='all'>
</head>

<body>
<div class='hp-navbar-top'>
  <div class='container'>
    <div class='row'>
      <div class='col-12'>
        <nav class='hp-nav'>
          <span>
            <a href='/' class='logo-a-tag'>
              <img class='hp-navbar-logo' src='/img/logo-kakaostyle.png'>
              <span class='hp-navbar-logo-font'>기술 블로그</span>
            </a>
          </span>
        </nav>
        <div class='float-right hp-navbar-top-link'>
          <a class='hp-nav-item' href='https://kakaostyle.com' target='_blank'>
            <img class='icon' src='/img/kakaostyle-icon.png'>
          </a>
          <a class='hp-nav-item' href='https://github.com/croquiscom' target='_blank'>
            <img class='icon' src='/img/github-icon.svg'>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
<div class='hp-navbar'>
  <div class='hp-navbar-bgcolor'>
    <div class='container'>
      <div class='text-center'>
        <div class='hp-navbar-title'>프론트엔드 테스트 자동화 전략 - 3. 구현하기</div>
      </div>
    </div>
  </div>
</div>


<div class='container'>

  <div class='row'>
    <div class='col-12'>
      <div class='post-header'>
        <div class='post-tags'>
          

<ul class='tag_box inline'>
  <li><i class='fas fa-tags'></i></li>
  
  <li>
    <a href='/ko/tags/frontend'>
      Frontend
      <span>8</span>
    </a>
  </li>
  
  <li>
    <a href='/ko/tags/testing'>
      Testing
      <span>5</span>
    </a>
  </li>
  
</ul>

        </div>
        <div class='float-right'>
          
          <div class='post-author'>
            <i class='fas fa-pencil-alt'></i>
            <span>Martin(유덕남)</span>
          </div>
          
          <div class='post-date'>
            <i class='fas fa-calendar-alt'></i>
            <span>04 August 2023</span>
          </div>
        </div>
      </div>
    </div>

    <div class='col-12 col-lg-9'>
      <p>이전 글에서는 제품의 요구사항을 분석하며, 테스트 케이스를 산출하는 방법에 대해 알아봤습니다. 이 글에서는 구체적으로 어떻게 테스트 코드를 작성할 수 있는지에 대해 알아봅니다.</p>
<h2 id="테스트-작성하기">테스트 작성하기</h2>
<p>첫 번째 글에서 언급한 바와 같이, 프론트엔드의 테스트는 대부분 통합 테스트로 간주될 수 있습니다. 프론트엔드의 주된 역할은 사용자, 서버 등 다양한 구성요소를 연결하는 것이기 때문에, 프론트엔드가 근본적으로 복잡한 로직을 가지는 경우는 그리 많지 않습니다. 하지만 다른 구성요소들이 연결되면서, 간단한 로직들이 서로 엉키면서 복잡해지는 경우가 대부분입니다.</p>
<p>그럼에도 불구하고 프론트엔드에서 직접 사용하는 로직이 존재할 수 있습니다. 예를 들어, 우편번호나 전화번호의 유효성을 검사하는 로직이나, 배송지가 제주나 산간 지역인지 판단하는 로직을 프론트엔드에서 구현할 수 있습니다. 이러한 로직들은 입력과 출력이 명확하고, 대부분 순수 함수로 만들어 관리할 수 있기 때문에 유닛 테스트를 작성할 수 있습니다. 유닛 테스트는 테스트가 간편한 편이고, 엄밀하게 검사해볼 수 있기 때문에 컴포넌트 내부에 순수 함수로 추출 가능하고, 충분히 복잡한 로직이 있는 경우 별도의 함수로 분리하는 것을 권장합니다.</p>
<p>UI 컴포넌트의 경우, 브라우저 환경, 사용자의 상호작용, 서버 API 등을 전제로 하는 경우가 많습니다. 이 경우, 하나의 함수로 입력과 출력을 테스트하기는 어렵고, UI 컴포넌트의 동작을 테스트해야 합니다. 이를 통합 테스트라고 합니다.</p>
<p>통합 테스트 관점에서는, 요구사항을 달성하기 위해서 다른 구성요소들과의 상호작용이 중요합니다. 구현 세부사항에 대한 테스트, 예를 들어 특정 클래스의 존재 여부나 컴포넌트의 상태를 확인하는 것은 요구사항 검증에 중요한 내용이 아닙니다.</p>
<p>테스트를 작성할 때는 이를 염두에 두어야 하며, 이를 통해 위양성이 발생하는 것을 피할 수 있습니다. 리팩토링을 진행하는 상황에서는 컴포넌트를 어떻게 개선할지에 대한 그림이 있으므로, 어떤 요소가 테스트에 포함되지 말아야 할 대상인지 파악할 수 있을 것입니다.</p>
<p>하지만, 하위 컴포넌트의 경우에는 콜백 함수 호출이나 props에 따른 동작을 테스트에 포함해야 합니다. 하위 컴포넌트 관점에서는 상위 컴포넌트는 제어할 수 있는 대상이 아니며, 우리가 제어할 수 없는 다른 구성 요소로 간주해야 합니다. 다시 말해, 기술적인 세부사항 자체가 하위 컴포넌트에서 요구되는 사항이 됩니다.</p>
<p><img src="/img/content/2023-08-04-3.png" alt="2023-08-04-3.png"></p>
<p>이러한 내용을 바탕으로 유닛 테스트와 통합 테스트를 작성하는 방법을 살펴보겠습니다.</p>
<h3 id="유닛-테스트">유닛 테스트</h3>
<p>일반적으로 테스트를 작성할 때는 jest, mocha, chai, vitest와 같은 프레임워크를 사용합니다. 이러한 프레임워크는 범용적으로 사용할 수 있어서, 프론트엔드뿐만 아니라 Node.js 서버 개발 등 다양한 분야에서 널리 활용됩니다.</p>
<p>각 테스트는 하나의 구성요소만을 확인해야 합니다. 예를 들어, &ldquo;checkRegion&rdquo; 함수를 테스트한다고 가정해봅시다. 테스트의 제목은 &ldquo;제주도 지역의 주소를 입력하면, is_jeju 가 true로 반환된다&quot;와 같이 요구사항을 명확하게 설명해야 합니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">checkRegion</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./utils&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;checkRegion&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;제주도 지역의 주소를 입력하면, is_jeju가 true로 반환된다&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Arrange
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">input</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">address</span><span class="o">:</span> <span class="s1">&#39;제주 제주시 공항로 2 제주국제공항&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">detail_address</span><span class="o">:</span> <span class="s1">&#39;공항 1층&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">city</span><span class="o">:</span> <span class="s1">&#39;제주시&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">state</span><span class="o">:</span> <span class="s1">&#39;제주&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">post_code</span><span class="o">:</span> <span class="s1">&#39;63115&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Act
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="p">{</span> <span class="nx">is_jeju</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">checkRegion</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Assert
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">expect</span><span class="p">(</span><span class="nx">is_jeju</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><p>테스트는 주로 AAA (Arrange, Act, Assert) 패턴으로 구성됩니다. 이는 테스트를 준비하는 단계, 실제로 &ldquo;checkRegion&rdquo; 함수를 실행해보는 단계, 그리고 실행 결과를 확인하는 단계로 나누어집니다. AAA 패턴을 사용하면 어떤 것을 검증하기 위해 테스트가 작성되었는지 명확하게 확인할 수 있습니다.</p>
<p>jest에서는 &ldquo;expect&rdquo; 함수를 사용하여 실행 결과를 확인할 수 있습니다. 예를 들어, &ldquo;expect(result).toBe(123);&ldquo;는 result가 123이어야 함을 기대하고, 다른 값이라면 테스트가 실패합니다.</p>
<p>함수 호출 여부를 확인해야 하는 경우에는 mock을 사용할 수도 있습니다. &ldquo;jest.fn()&ldquo;을 사용하면 jest의 mock 함수를 생성할 수 있습니다. 이 mock 함수는 호출될 때마다 전달된 매개변수와 반환값을 기록합니다. 이를 통해 mock 함수의 호출 여부나 매개변수 전달이 올바른지를 검증할 수 있습니다.</p>
<p>또한 jest.mock, jest.spyOn과 같은 기능들도 존재합니다. 이를 사용하면 &ldquo;fs&quot;나 &ldquo;localStorage&quot;와 같은 다양한 객체들의 구현을 우리가 만든 함수로 대체할 수 있습니다. 이를 통해 구현체가 특정 상황을 가정하도록 해서 테스트를 작성할 수 있습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">fs</span> <span class="kr">from</span> <span class="s1">&#39;fs&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">saveExcel</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./saveExcel&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;saveExcel&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;saveExcel은 파일을 저장한다&#39;</span><span class="p">,</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">writeFileFn</span> <span class="o">=</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">spyOn</span><span class="p">(</span><span class="nx">fs</span><span class="p">,</span> <span class="s1">&#39;writeFile&#39;</span><span class="p">).</span><span class="nx">mockImplementation</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{});</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">callbackFn</span> <span class="o">=</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">input</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;이름&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;테스트&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="nx">saveExcel</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="s1">&#39;output.xlsx&#39;</span><span class="p">,</span> <span class="nx">callbackFn</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">expect</span><span class="p">(</span><span class="nx">writeFileFn</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">expect</span><span class="p">(</span><span class="nx">callbackFn</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><p>mock의 사용에 대해서는 상반된 의견이 존재합니다. &ldquo;Mockist&quot;와 &ldquo;Classical&rdquo; 테스트 전략으로 구분되는데, 프론트엔드에서는 Mockist 전략을 따르기는 어렵다고 생각이 들긴 합니다. 관련된 내용은 백엔드 관점에서 쓰여진 자료가 많긴 하지만, 쉽게 찾아볼 수 있으므로 궁금하시면 참고해보시기 바랍니다. (<a href="https://algopoolja.tistory.com/119">#</a>)</p>
<h3 id="통합-테스트">통합 테스트</h3>
<p>통합 테스트는 하나의 구성요소가 아닌 여러 구성요소들이 함께 동작하는지를 확인하는 테스트입니다. 이러한 테스트는 각 구성요소들의 상호작용을 검증하고, 구체적인 구현 내용은 검증하지 않습니다. 따라서, 프론트엔드의 경우 대부분의 테스트가 통합 테스트 범주에 속한다고 볼 수 있습니다. 이는 프론트엔드 자체가 여러 구성요소를 연결하는 역할을 수행하기 때문입니다.</p>
<p>통합 테스트도 jest와 같은 테스트 프레임워크를 사용하여 작성할 수 있습니다. 사실 테스트 프레임워크 입장에서는 유닛 테스트와 통합 테스트를 명확히 구분하지 않으며, 우리의 편의를 위해 이를 구분해놓은 것입니다.</p>
<p>하지만, 프론트엔드에서는 스토리북을 이미 활용하고 있는 경우가 많습니다. 스토리북은 각 컴포넌트를 격리시켜놓고, 컴포넌트의 실행에 필요한 환경과 목을 제공합니다. 따라서, 스토리북을 사용하고 있다면 별도로 통합 테스트 코드를 작성하는 대신, 스토리북에서 제공하는 <a href="https://storybook.js.org/docs/writing-tests/interaction-testing">Interaction tests</a>을 활용하는 것이 좋습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">Save</span> <span class="o">=</span> <span class="nx">Primary</span><span class="p">.</span><span class="nx">bind</span><span class="p">({});</span>
</span></span><span class="line"><span class="cl"><span class="nx">Save</span><span class="p">.</span><span class="nx">storyName</span> <span class="o">=</span> <span class="s1">&#39;주소를 입력하고 저장 버튼을 누르면 저장 API가 호출되고 onClose가 호출된다&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">Save</span><span class="p">.</span><span class="nx">play</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">({</span> <span class="nx">canvasElement</span><span class="p">,</span> <span class="nx">args</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">{</span> <span class="nx">getSpy</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">initMSWSpy</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nx">within</span><span class="p">(</span><span class="nx">canvasElement</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">userEvent</span><span class="p">.</span><span class="nx">input</span><span class="p">(</span><span class="k">await</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">findByPlaceholderText</span><span class="p">(</span><span class="s1">&#39;주소를 입력해주세요.&#39;</span><span class="p">),</span> <span class="s1">&#39;서울 중구 세종대로 2&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">userEvent</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="k">await</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="s1">&#39;저장&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">expect</span><span class="p">(</span><span class="nx">getSpy</span><span class="p">(</span><span class="s1">&#39;UpdateUserShippingAddressBook&#39;</span><span class="p">)).</span><span class="nx">toBeCalled</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">expect</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">onClose</span><span class="p">).</span><span class="nx">toBeCalled</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>Interaction tests을 활용하면 위와 같이 테스트를 작성할 수 있습니다.</p>
<p>스토리북은 각 컴포넌트의 유형에 따라 스토리로 관리되며, 테스트를 위해 추가로 스토리를 생성할 수 있습니다.</p>
<p>각 테스트는 사용자의 행동이나 props와 같이, 컴포넌트의 동작을 결정짓거나 사용자의 여정을 나타낼 수 있는 이름으로 작성되어야 합니다.</p>
<ul>
<li>&ldquo;주소를 입력하고 저장 버튼을 누르면 저장 API가 호출되고 onClose가 호출된다.&rdquo;</li>
<li>&ldquo;주소를 입력하지 않으면 저장 버튼이 비활성화된다.&rdquo;</li>
</ul>
<p>통합 테스트는 사용자의 여정을 나타내는 형태로 작성되기 때문에 AAA 패턴을 적용하기 어려운 경우가 많습니다. 대신 &ldquo;구성, 행동, 확인, 행동, 확인&quot;과 같이 &ldquo;행동, 확인&rdquo; 단계가 반복되는 패턴으로 작성됩니다.</p>
<p>예를 들어, &ldquo;주소를 입력하고&rdquo; &ldquo;주소가 입력되었는지 확인하고&rdquo; &ldquo;저장 버튼을 누르고&rdquo; &ldquo;저장 API가 호출되었는지 확인하고&rdquo; &ldquo;onClose가 호출되었는지 확인합니다&quot;와 같이, 테스트는 여러 단계로 나뉘어 진행됩니다.</p>
<h3 id="스토리-자체로써-테스트">스토리 자체로써 테스트</h3>
<p>사실, 스토리북을 컴포넌트별로 잘 구성했다면 추가로 테스트를 작성하지 않아도, 컴포넌트에서 “켜기만 했을 뿐인데 오류가 발생하는 상황”을 스토리북에서 잡아낼 수 있습니다. 이렇게, 별도의 검증 로직 없이 단순히 켜지는지 테스트하는 것을 “Smoke test”라고 부릅니다.</p>
<p>스토리북만 작성한다면, 아무 것도 하지 않아도 스토리를 smoke test로 손쉽게 변환해볼 수도 있습니다. 개발적으로 별다른 작업이 필요한 것은 아니고, 테스트를 자동으로 실행해주는 라이브러리 (jest, storybook/test-runner 등)에서 구성해주면 됩니다. 관련된 내용은 다음 글에서 다뤄볼 예정입니다.</p>
<h2 id="모킹하기">모킹하기</h2>
<p>통합 테스트를 위해서는 제품을 사용하는 환경을 흉내낼 수 있어야 합니다. 이런 일련의 과정을 모킹이라고 부릅니다.</p>
<h3 id="사용자-행동-흉내내기-testing-libraryreact">사용자 행동 흉내내기 (testing-library/react)</h3>
<p>React에서 테스트를 작성할 때는 <a href="https://testing-library.com/docs/react-testing-library/intro/">React Testing Library</a>를 사용하는 것이 권장됩니다. 이 테스트 라이브러리는 React 내부 동작에는 신경쓰지 않고, 사용자 관점에서 테스트를 작성할 수 있도록 설계되어 있습니다.</p>
<p>테스트를 작성할 때는 HTML 태그, alt 속성, 텍스트 등 외적으로 보이는 요소를 검색하고, 해당 요소에 클릭이나 키보드 이벤트 등을 발생시키며, 외적으로 보이는 결과를 확인하여 검증합니다.</p>
<p>UI의 경우, 필요한 특정 노드가 보이지 않으면 테스트는 실패한 것으로 간주될 수 있기 때문에 사용자의 여정을 따라가는 방법으로도 테스트를 작성할 수 있습니다.</p>
<p>요소를 찾기 위해 텍스트나 HTML 태그를 사용할 수 없는 경우, 가능하면 시맨틱 HTML이나, ARIA 태그 등 접근성을 고려한 방법으로 코드를 변경하는 것이 좋습니다.</p>
<p>className이나 id를 사용하는 것은 권장되지 않습니다. 이러한 요소는 컴포넌트의 리팩토링 과정에서 쉽게 변경될 수 있으며, 사용자 관점에서는 중요하지 않기 때문입니다.</p>
<p>이런 ID가 꼭 필요하다면, data-testid를 사용하면 해당 요소가 테스트에 중요하다는 것을 명확히 인식할 수 있으므로 리팩토링 과정에서 오류를 발생시키지 않도록 도움을 줄 수 있습니다.</p>
<p>대부분의 프론트엔드 로직은 비동기로 동작하므로, React Testing Library는 비동기 작업을 쉽게 수행할 수 있도록 설계되었습니다.</p>
<p>DOM 노드를 가져오기 위해 <code>await canvas.findByText(/도움말/)</code>와 같은 방법을 사용하거나, 클릭 이벤트를 시뮬레이션하기 위해 <code>await userEvent.click(element)</code>와 같은 방법을 사용할 수 있습니다. 또한, input이나 keyboard 등 사용자의 행동을 표현할 수 있는 다양한 기능을 제공합니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="nx">CreateNew</span><span class="p">.</span><span class="nx">storyName</span> <span class="o">=</span> <span class="s1">&#39;API 키를 생성할 수 있고, 약관 동의 모달이 표시된다&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">CreateNew</span><span class="p">.</span><span class="nx">play</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">({</span> <span class="nx">canvasElement</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">{</span> <span class="nx">getSpy</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">initMSWSpy</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nx">within</span><span class="p">(</span><span class="nx">canvasElement</span><span class="p">.</span><span class="nx">parentElement</span><span class="o">!</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">userEvent</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="k">await</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="sr">/인증키 발급/</span><span class="p">,</span> <span class="p">{</span> <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;button&#39;</span> <span class="p">}));</span>
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">userEvent</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="k">await</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="s1">&#39;동의&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;button&#39;</span> <span class="p">}));</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">modal_el</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="s1">&#39;인증키 발급 완료&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">expect</span><span class="p">(</span><span class="nx">getSpy</span><span class="p">(</span><span class="s1">&#39;CreateAuthKey&#39;</span><span class="p">)).</span><span class="nx">toBeCalled</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">userEvent</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="k">await</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="s1">&#39;복사하기&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;button&#39;</span> <span class="p">}));</span>
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">userEvent</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="k">await</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="s1">&#39;확인&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;button&#39;</span> <span class="p">}));</span>
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">waitForElementToBeRemoved</span><span class="p">(</span><span class="nx">modal_el</span><span class="p">,</span> <span class="p">{</span> <span class="nx">timeout</span>: <span class="kt">1000</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>자세한 내용은 React Testing Library의 문서를 참조해 주세요.</p>
<h3 id="서버-흉내내기-msw">서버 흉내내기 (MSW)</h3>
<p>스토리북에서 컴포넌트를 테스트할 때는 실제 서버에 연결하지 않고 API 응답을 모방하여 구현하게 됩니다. 이러한 모킹은 <a href="https://mswjs.io/">MSW</a>를 사용하여 처리할 수 있습니다.</p>
<p>스토리북에서는 MSW를 쉽게 사용할 수 있도록 도와주는 <a href="https://storybook.js.org/addons/msw-storybook-addon">MSW 애드온</a>이 있습니다. 이 애드온을 사용하면 각 스토리에 사용할 목을 지정하는 방법으로 MSW를 구성할 수 있습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">Story</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="nt">Component</span> <span class="p">/&gt;;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">Story</span><span class="p">.</span><span class="nx">parameters</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">msw</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">handlers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">user</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="nx">graphql</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s1">&#39;GetUser&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">data</span><span class="p">({</span> <span class="p">...</span> <span class="p">})),</span>
</span></span><span class="line"><span class="cl">        <span class="nx">graphql</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s1">&#39;GetUsers&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">data</span><span class="p">({</span> <span class="p">...</span> <span class="p">})),</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>하지만, 컴포넌트에서 API 호출이 불규칙하게 일어나게 되고, 페이지마다 명시적으로 API 호출을 추적하지 않기 때문에 시간이 흐를수록 점점 목을 관리하기가 어려워졌습니다.</p>
<p>파트너센터 제품에서는 페이지마다 사용할 목을 관리하는 대신, 공통으로 사용할 msw 목을 한 곳에 모아 프로젝트 전체에서 공유하는 방법으로, API 호출에 대해 신경쓰지 않는 방향으로 모킹을 구성했습니다.</p>
<p>어떤 방법을 사용하더라도, 스토리마다 오버라이드가 가능하다면 괜찮다고 생각합니다.</p>
<p>MSW 목은 단순히 데이터를 반환하는 것뿐만 아니라, 실제로 localStorage에 값을 쓰거나 로직에 따라 다른 데이터를 반환하는 등 다양한 작업을 수행할 수 있습니다. 하지만 MWS 목의 로직이 복잡해질수록 실제 로직을 테스트하는 대신 모킹의 로직을 테스트하는 상황이 발생할 수 있습니다. 예를 들어, 목에서 localStorage를 제어하므로 테스트에 localStorage를 검증하는 로직이 들어간다면 이는 컴포넌트의 동작을 테스트하는 것이 아니라, 목을 테스트하고 있기 때문에 옳지 않은 상황으로 볼 수 있습니다.</p>
<p>편의상 &ldquo;목&quot;이라는 표현했지만, 이렇게 테스트에 사용되는 기능들을 &ldquo;테스트 더블(test double)&ldquo;이라고도 부르고, 목은 그 중 하나입니다. 프론트엔드 테스트에서는 그다지 중요하지 않기 때문에 자세히 다루지는 않겠습니다.</p>
<p>MSW에서는 API가 호출되었는지 확인하는 기능을 제공하고 있지 않아서, 컴포넌트에서 “저장” API를 제대로 호출했는지 확인해보기가 어려웠습니다. 이를 해결하기 위해 <code>initMSWSpy</code> 함수를 별도로 제작해서, GraphQL 호출을 열어볼 수 있도록 작업했습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">jest</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@storybook/jest&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">getWorker</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;msw-storybook-addon&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 테스트 코드에서 서버로의 요청이 정상적으로 이루어지는지 확인하기 위해 사용되는 Spy입니다.
</span></span></span><span class="line"><span class="cl"><span class="c1">// 목의 정합성을 테스트하는 용도가 아닌, 클라이언트에서 서버로 보내는 API 요청의
</span></span></span><span class="line"><span class="cl"><span class="c1">// 유무를 검증하기 위한 용도로만 사용해주세요!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">SPY_MAP</span>: <span class="kt">Map</span><span class="p">&lt;</span><span class="nt">string</span><span class="p">,</span> <span class="na">jest.Mock</span><span class="p">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">IS_INITIALIZED</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">initMSWSpy</span><span class="p">()</span><span class="o">:</span> <span class="p">{</span> <span class="nx">getSpy</span><span class="o">:</span> <span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">Mock</span> <span class="p">}</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SPY_MAP</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nx">getSpy</span><span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">Mock</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">entry</span> <span class="o">=</span> <span class="nx">SPY_MAP</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">entry</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">new_entry</span> <span class="o">=</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">()</span> <span class="kr">as</span> <span class="kt">unknown</span> <span class="kr">as</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">Mock</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">SPY_MAP</span><span class="p">.</span><span class="kr">set</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">new_entry</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">new_entry</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">entry</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">IS_INITIALIZED</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">getWorker</span><span class="p">().</span><span class="nx">events</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;request:end&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">pathname</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">gql_pattern</span> <span class="o">=</span> <span class="sr">/graphql\/([a-zA-Z0-9_-]+)$/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">gql_pattern</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">name</span> <span class="o">=</span> <span class="nx">gql_pattern</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">mock_fn</span> <span class="o">=</span> <span class="nx">getSpy</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nx">mock_fn</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nx">IS_INITIALIZED</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span> <span class="nx">getSpy</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="nx">CreateNew</span><span class="p">.</span><span class="nx">storyName</span> <span class="o">=</span> <span class="s1">&#39;주소를 새로 등록할 수 있다&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">CreateNew</span><span class="p">.</span><span class="nx">play</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">({</span> <span class="nx">canvasElement</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">{</span> <span class="nx">getSpy</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">initMSWSpy</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nx">within</span><span class="p">(</span><span class="nx">canvasElement</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">userEvent</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="k">await</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">findByText</span><span class="p">(</span><span class="s1">&#39;저장&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">expect</span><span class="p">(</span><span class="nx">getSpy</span><span class="p">(</span><span class="s1">&#39;CreateUserShippingAddressBook&#39;</span><span class="p">)).</span><span class="nx">toBeCalled</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>이렇게 사용자의 행동을 모방하는 방법과 서버의 동작을 모방하는 방법(API 목)을 살펴보았습니다. 이 둘이 제일 중요하긴 하지만, 프론트엔드에서는 이 두 가지만 있는 것은 아닙니다. 예를 들어, 주소록에서는 다음 우편번호 서비스를 사용하고 있습니다. 하지만 다음 우편번호 서비스의 UI는 우리가 제어할 수 없기 때문에 이를 테스트하는 것은 좋은 방법이 아닙니다.</p>
<p>이렇듯 이외에도 다른 구성요소들이 존재하는데, 이런 다른 구성요소를 모킹하는 방법을 알아봅시다.</p>
<h3 id="컨텍스트-흉내내기">컨텍스트 흉내내기</h3>
<p>React 컴포넌트에서는 Context를 자주 사용하는 경우가 많습니다. Context를 사용하면 상위 컴포넌트에서 하위 컴포넌트로 값들을 암시적으로 전달할 수 있습니다. 이 Context 기능은 전역적으로 사용되는 값이나 환경과 관련된 값들을 전달하는 용도로 자주 활용됩니다.</p>
<p>Context를 모킹하기 위해서는 스토리북의 decorator를 사용해 간단히 처리할 수 있습니다. 예를 들어, react-router를 사용하는 경우에는 decorators에 MemoryRouter를 넣어 테스트하고자 하는 컴포넌트를 덮어씌워주기만 하면 됩니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="nx">Story</span><span class="p">.</span><span class="nx">decorators</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nx">Story</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">MemoryRouter</span> <span class="na">initialEntries</span><span class="o">=</span><span class="p">{[</span><span class="s1">&#39;/&#39;</span><span class="p">]}&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">Story</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">MemoryRouter</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span></code></pre></div><h3 id="기타-구성요소-모킹하기">기타 구성요소 모킹하기</h3>
<p>jest는 다른 구성요소들을 우리가 만든 객체로 대체할 수 있는 목(Mock) 기능을 제공하고 있습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">fs</span> <span class="kr">from</span> <span class="s1">&#39;fs/promises&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;fs/promises&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;fs 테스트&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">expect</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">).</span><span class="nx">toBeCalled</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><p>주로 &ldquo;jest.mock&quot;이 사용되지만, 웹 브라우저 환경에서는 외부와의 통신을 위해 별도의 객체로 만들어진 내용들이 window 객체 안에 있기 때문에 jest.mock을 사용하기 어려울 수 있습니다.</p>
<p>이 경우에는 &ldquo;jest.fn&quot;을 사용하여 특정 함수를 교체하거나, &ldquo;jest.spyOn&quot;을 사용해볼 수 있습니다.</p>
<p>jest.spyOn을 사용하면 기존의 구현체를 그대로 유지하면서 해당 객체가 읽고 쓰는 값을 감시할 수 있습니다. 반면 jest.fn을 사용하면 원하는 함수로 특정 함수를 대체할 수 있습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="nx">Story</span><span class="p">.</span><span class="nx">play</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">oldPostcode</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">daum</span><span class="p">.</span><span class="nx">Postcode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Postcode의 동작을 새로 덮어 쓴다
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nb">window</span><span class="p">.</span><span class="nx">daum</span><span class="p">.</span><span class="nx">Postcode</span> <span class="o">=</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">open</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 주소 입력 콜백을 호출한다
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">args</span><span class="p">.</span><span class="nx">oncomplete</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">expect</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">daum</span><span class="p">.</span><span class="nx">Postcode</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 스토리북에서 테스트를 진행하는 경우 덮어쓰기 전의 값으로 되돌림
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nb">window</span><span class="p">.</span><span class="nx">daum</span><span class="p">.</span><span class="nx">Postcode</span> <span class="o">=</span> <span class="nx">oldPostcode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">Story</span><span class="p">.</span><span class="nx">play</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 실제 window.daum.Postcode를 활용한다
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">jest</span><span class="p">.</span><span class="nx">spyOn</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">daum</span><span class="p">,</span> <span class="s1">&#39;Postcode&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">expect</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">daum</span><span class="p">.</span><span class="nx">Postcode</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>단, 목 함수를 사용한 후에는 테스트 환경이 새로고침되기 전까지는 해당 함수가 수정된 상태로 유지되므로 주의해야 합니다. jest는 “jest.restoreAllMocks” 와 같은 유틸 함수를 제공해주기 때문에 이런 문제에서 자유로운 편이지만, 스토리북에서는 관련된 유틸 함수가 존재하지 않으므로 유의해야 합니다. 기존 객체를 들고 있다가 테스트가 끝나는 시점에 되돌려주는 등의 로직이 별도로 필요합니다!</p>
<h2 id="e2e-테스트">E2E 테스트</h2>
<p>통합 테스트를 작성해도, 하나의 페이지나 컴포넌트에 대해서만 테스트를 진행하기 때문에, 사용자 여정의 전체를 확인해보기는 어렵습니다. 이런 내용을 확인해보고 싶으면 E2E (End-to-End) 테스트를 작성해볼 수 있습니다.</p>
<p>E2E 테스트는 mock이 아닌, 실제로 환경에서 사용자와 동일하게 테스트를 진행해봅니다. 이를 위한 도구로는 Cypress, Playwright와 같은 것들이 있습니다.</p>
<p>하지만, E2E 테스트는 특성상 준비 과정이 까다롭고, 깨지기 쉽고, 진행 시간도 오래 걸리기 때문에 다루지 않았습니다. 특히, E2E 테스트에서 실패가 발생하면 어떤 부분에서 이슈가 발생했는지 파악하기 어렵다는 특징이 있습니다.</p>
<p>그럼에도 불구하고, 실제로 사용자가 문제를 겪을 수 있을 지 광범위하게 확인하는 용도로는 유용하기 때문에, 나중에 검토해볼 수 있겠습니다. 이 글에서는 E2E 테스트까지는 다루지는 않았습니다.</p>
<h2 id="마치며">마치며</h2>
<p>다뤘던 내용을 간단하게 정리하면서 마무리해봅시다.</p>
<ul>
<li>프론트엔드의 테스트는 대부분 통합 테스트입니다. 그러나 유닛 테스트로 분리 가능한 것들은 함수로 따로 떼내는 것이 좋습니다.</li>
<li>유닛 테스트는 하나의 구성요소를 단독으로 분리해서 입력과 출력을 테스트해봅니다.</li>
<li>테스트는 3가지 패턴으로 나뉘어집니다. AAA (Arranage 구성, Act 행동, Assert 확인).</li>
<li>통합 테스트는 여러 구성요소들의 상호작용을 검증하고, 구체적인 구현을 검증하지는 않습니다.</li>
<li>프론트엔드에서는 스토리북에 이미 테스트 환경을 구성해두고 있으므로, 스토리북의 Interaction tests를 활용하는 것이 좋습니다.</li>
<li>작성된 스토리북을 단순히 제대로 돌아가는지 테스트하는 것만으로도 기본적인 검증이 가능합니다.</li>
<li>통합 테스트는 사용자 여정에 따라 “행동, 확인”이 계속해서 반복되는 구조입니다. 사용자 여정을 잘 드러내는 테스트를 작성하는 것이 좋습니다.</li>
<li>React UI를 테스트할 때에는 React Testing Library를 사용합니다. 내부 구현에는 신경쓰지 않고, 유저에게 보이는 것들을 위주로 테스트합니다.</li>
<li>서버 모킹은 MSW를 사용해서 처리합니다.</li>
<li>컨텍스트는 스토리북의 decorator 기능을 사용해서 처리합니다.</li>
<li>이 외의 다른 구성요소는 jest.spyOn, jest.fn을 활용해서 처리할 수 있지만, 테스트 환경이 오염될 수 있으므로 유의해야 합니다.</li>
<li>사용자의 여정 전체를 확인해보려면, E2E 테스트의 작성도 고려해볼 수 있습니다.</li>
</ul>
<p>테스트 환경 구축에 대해 아직 다루지 않았음을 알아채셨을 것입니다. 테스트 환경은 그 특수성으로 인해 구축이 어려운 경우가 많고, 상당한 양의 컴퓨터 자원을 요구하기 때문에 GitHub Actions와 같은 CI/CD에 관련해서도 고려해야 하는 내용이 있습니다. 다음 글에서는 테스트 환경 구축에 대해 자세히 알아보도록 하겠습니다.</p>
<p>하지만, 스토리북은 이미 Interaction tests이라는 이름으로 테스트 환경을 내장하고 있습니다. 스토리북 버전을 7로 업데이트하는 것을 권장하지만, 패키지 버전을 잘 신경쓴다면 6.5 버전에서도 실험해볼 수 있습니다. 스토리북의 Interaction tests을 사용하면 별도의 테스트 환경을 구축하지 않고도 스토리북 내부에서 테스트를 실행해볼 수 있습니다.</p>
<p>아직 스토리북 6.5 버전을 사용하고 있다면, 아래 패키지들을 사용하면 됩니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;@storybook/addon-interactions&#34;</span><span class="p">:</span> <span class="s2">&#34;^6.5.16&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;@storybook/testing-library&#34;</span><span class="p">:</span> <span class="s2">&#34;^0.0.13&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;@storybook/jest&#34;</span><span class="p">:</span> <span class="s2">&#34;^0.0.10&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>이렇게 해서, 프론트엔드 앱에서 요구사항과 테스트 케이스를 산출해내고 실제로 구현하는 방법까지 알아봤습니다. 스토리북을 활용하면 테스트를 작성해보는 허들이 많이 낮아서, 손쉽게 시도해볼 수 있을 것이라고 생각합니다.</p>
<p>다음 번에 리팩토링을 진행할 때, 실제로 테스트를 작성해보시면 더 잘 이해해보실 수 있으리라 생각합니다. 테스트에 관련해서 이 글이 도움이 되었기를 바랍니다.</p>
      
    </div>

    <div class='col-lg-3 sidemenu'>
  <h4>Recent Posts</h4>
  <ul class="sidemenu-recent-list">
    
    <a href='/ko/2024-10-07-1-animation-module/'>
      <li class="sidemenu-recent-item">기획전 애니메이션 모듈 개발</li>
    </a>
    
    <a href='/ko/2024-08-09-1-ui-testing-automation/'>
      <li class="sidemenu-recent-item">UI 테스트 자동화</li>
    </a>
    
    <a href='/ko/2024-08-04-1-improve-server-driven-ui/'>
      <li class="sidemenu-recent-item">Server Driven UI 호출 구조 개선</li>
    </a>
    
    <a href='/ko/2024-06-28-1-optimize-font-traffic/'>
      <li class="sidemenu-recent-item">웹폰트 최적화를 통한 CDN 비용절감</li>
    </a>
    
  </ul>
  <hr>
  <h4>Tags</h4>
  <ul class="sidemenu-recent-list">
    
    <a href="/ko/tags/amazon-sqs/">
      <li class="sidemenu-recent-tags">amazon sqs</li>
    </a>
    
    <a href="/ko/tags/analytics/">
      <li class="sidemenu-recent-tags">analytics</li>
    </a>
    
    <a href="/ko/tags/android/">
      <li class="sidemenu-recent-tags">android</li>
    </a>
    
    <a href="/ko/tags/aws/">
      <li class="sidemenu-recent-tags">aws</li>
    </a>
    
    <a href="/ko/tags/aws-batch/">
      <li class="sidemenu-recent-tags">aws batch</li>
    </a>
    
    <a href="/ko/tags/aws-lambda/">
      <li class="sidemenu-recent-tags">aws lambda</li>
    </a>
    
    <a href="/ko/tags/botkit/">
      <li class="sidemenu-recent-tags">botkit</li>
    </a>
    
    <a href="/ko/tags/croquis/">
      <li class="sidemenu-recent-tags">croquis</li>
    </a>
    
    <a href="/ko/tags/css/">
      <li class="sidemenu-recent-tags">css</li>
    </a>
    
    <a href="/ko/tags/data/">
      <li class="sidemenu-recent-tags">data</li>
    </a>
    
    <a href="/ko/tags/event/">
      <li class="sidemenu-recent-tags">event</li>
    </a>
    
    <a href="/ko/tags/front-end/">
      <li class="sidemenu-recent-tags">front-end</li>
    </a>
    
    <a href="/ko/tags/frontend/">
      <li class="sidemenu-recent-tags">frontend</li>
    </a>
    
    <a href="/ko/tags/git/">
      <li class="sidemenu-recent-tags">git</li>
    </a>
    
    <a href="/ko/tags/github/">
      <li class="sidemenu-recent-tags">github</li>
    </a>
    
    <a href="/ko/tags/graphql/">
      <li class="sidemenu-recent-tags">graphql</li>
    </a>
    
    <a href="/ko/tags/ios/">
      <li class="sidemenu-recent-tags">ios</li>
    </a>
    
    <a href="/ko/tags/jenkins/">
      <li class="sidemenu-recent-tags">jenkins</li>
    </a>
    
    <a href="/ko/tags/jotai/">
      <li class="sidemenu-recent-tags">jotai</li>
    </a>
    
    <a href="/ko/tags/kubernetes/">
      <li class="sidemenu-recent-tags">kubernetes</li>
    </a>
    
    <a href="/ko/tags/log/">
      <li class="sidemenu-recent-tags">log</li>
    </a>
    
    <a href="/ko/tags/microservice/">
      <li class="sidemenu-recent-tags">microservice</li>
    </a>
    
    <a href="/ko/tags/mithril/">
      <li class="sidemenu-recent-tags">mithril</li>
    </a>
    
    <a href="/ko/tags/node.js/">
      <li class="sidemenu-recent-tags">node.js</li>
    </a>
    
    <a href="/ko/tags/nodejs/">
      <li class="sidemenu-recent-tags">nodejs</li>
    </a>
    
    <a href="/ko/tags/npm/">
      <li class="sidemenu-recent-tags">npm</li>
    </a>
    
    <a href="/ko/tags/react/">
      <li class="sidemenu-recent-tags">react</li>
    </a>
    
    <a href="/ko/tags/rest-api/">
      <li class="sidemenu-recent-tags">rest api</li>
    </a>
    
    <a href="/ko/tags/serverless-architecture/">
      <li class="sidemenu-recent-tags">serverless architecture</li>
    </a>
    
    <a href="/ko/tags/slack/">
      <li class="sidemenu-recent-tags">slack</li>
    </a>
    
    <a href="/ko/tags/stack/">
      <li class="sidemenu-recent-tags">stack</li>
    </a>
    
    <a href="/ko/tags/storybook/">
      <li class="sidemenu-recent-tags">storybook</li>
    </a>
    
    <a href="/ko/tags/task-queue/">
      <li class="sidemenu-recent-tags">task queue</li>
    </a>
    
    <a href="/ko/tags/testing/">
      <li class="sidemenu-recent-tags">testing</li>
    </a>
    
    <a href="/ko/tags/thrift/">
      <li class="sidemenu-recent-tags">thrift</li>
    </a>
    
    <a href="/ko/tags/tutorial/">
      <li class="sidemenu-recent-tags">tutorial</li>
    </a>
    
    <a href="/ko/tags/typescript/">
      <li class="sidemenu-recent-tags">typescript</li>
    </a>
    
    <a href="/ko/tags/ui/">
      <li class="sidemenu-recent-tags">ui</li>
    </a>
    
    <a href="/ko/tags/vertical-align/">
      <li class="sidemenu-recent-tags">vertical-align</li>
    </a>
    
    <a href="/ko/tags/webpack/">
      <li class="sidemenu-recent-tags">webpack</li>
    </a>
    
    <a href="/ko/tags/%EB%A1%9C%EA%B7%B8/">
      <li class="sidemenu-recent-tags">로그</li>
    </a>
    
    <a href="/ko/tags/%EB%A7%88%EC%9D%B4%ED%81%AC%EB%A1%9C%EC%84%9C%EB%B9%84%EC%8A%A4/">
      <li class="sidemenu-recent-tags">마이크로서비스</li>
    </a>
    
    <a href="/ko/tags/%ED%8A%9C%ED%86%A0%EB%A6%AC%EC%96%BC/">
      <li class="sidemenu-recent-tags">튜토리얼</li>
    </a>
    
  </ul>
</div>

    <div class='col-12'>
      <hr>

      <div class='float-left'>
        
        <a class='btn btn-outline-primary' href='/ko/2023-08-04-2-frontend-testing-2-requirement/' title='프론트엔드 테스트 자동화 전략 - 2. 요구사항 분석'>&larr; 이전 글</a>
        
      </div>
      <div class='float-right'>
        
        <a class='btn btn-outline-primary' href='/ko/2023-08-04-4-frontend-testing-4-setup-environment/' title='프론트엔드 테스트 자동화 전략 - 4. 테스트 환경 구성'>다음 글 &rarr;</a>
        
      </div>
      <div class='clearfix'></div>
      <hr>
      <div class='text-center'>
        <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "croquiscom-devblog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </div>
  </div>

</div>

<div class='container'>
  <hr>
  <footer>
    <p>
      &copy; 2012-2021 kakaostyle.com
      <span class='float-right text-muted'>
        powered by
        <a href='https://gohugo.io/' target='_blank'>Hugo</a>
        and
        <a href='https://getbootstrap.com/' target='_blank'>Bootstrap</a>
      </span>
    </p>
  </footer>
</div>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-HBL5QKGKNR"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-HBL5QKGKNR');
        }
      </script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
  integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
  integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"
  integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
<script src="https://use.fontawesome.com/releases/v5.0.13/js/all.js"
  integrity="sha384-xymdQtn1n3lH2wcu0qhcdaOpQwyoarkgLVxC/wZ5q7h9gHtxICrpcaSUfygqZGOe" crossorigin="anonymous"></script>

</body>

</html>
